<div class="content-heading mb-lg">
  退款详情
</div>

<div class="panel panel-default" *ngIf="afterData">
  <div class="panel-body">
    <div class="ordernum">
      <span>退单编号：{{afterData.afterNo}}</span>
    </div>
    <div class="panel-body">
      <div>
        <div class="">
          <legend class="m0" style="height: 51px;line-height: 51px;">买家退款申请</legend>
        </div>
        <table class="t-items p w100">
          <tr class="t-item clearfix">
            <td class="item-hd col-sm-1">申请时间：</td>
            <td class="item-bd col-sm-9 mb0">{{afterData.createTime}}</td>
          </tr>
          <tr class="t-item clearfix">
            <td class="item-hd col-sm-2">申请人（买家）：</td>
            <td class="item-bd col-sm-10 mb0">{{afterData.custPhone}}</td>
          </tr>
          <tr class="t-item clearfix">
            <td class="item-hd col-sm-2">订单编号：</td>
            <td class="item-bd col-sm-10 mb0">
              <a routerLink="../../orders/cust/order-detail" [queryParams]="{ordno: afterData.ordno}">{{afterData.ordno}}</a>
            </td>
          </tr>
          <tr class="t-item clearfix">
            <td class="item-hd col-sm-2">商品名称：</td>
            <td class="item-bd col-sm-10 mb0">
              {{afterData.goodsName}}
              <a routerLink="../../goods/publish/edit" [queryParams]="{baseCode: afterData.goodsBaseCode}">查看</a>
            </td>
          </tr>
          <tr class="t-item clearfix">
            <td class="item-hd col-sm-2">退款金额：</td>
            <td class="item-bd col-sm-10 mb0">{{afterData.reqMoney}}</td>
          </tr>
          <tr class="t-item clearfix">
            <td class="item-hd col-sm-2">是否收到货：</td>
            <td class="item-bd col-sm-10 mb0">{{afterData.isReceive | rzhState:'1001'}}</td>
          </tr>
          <tr class="t-item clearfix">
            <td class="item-hd col-sm-2">退款原因：</td>
            <td class="item-bd col-sm-10 mb0">{{afterData.reason}}</td>
          </tr>
          <tr class="t-item clearfix">
            <td class="item-hd col-sm-2">退款说明：</td>
            <td class="item-bd col-sm-10 mb0">{{afterData.reasonRmk}}</td>
          </tr>
          <tr class="t-item clearfix">
            <td class="item-hd col-sm-2">凭证：</td>
            <td class="item-bd col-sm-10 mb0">
              <span *ngFor="let item of afterData.afterGoodsReqVouList">
                <img class="goods-md-img mr" [src]="item.vpic"
                     onerror="javascript:this.src='../../../../assets/img/dummy.png'" alt=""></span>
            </td>
          </tr>
        </table>

        <!--平台同意申请并退款-->
        <ng-container *ngIf="afterData.state=='AGREE' || afterData.state=='DONE'">
          <div>
            <div class="">
              <legend class="m0" style="height: 51px;line-height: 51px;">平台退款处理</legend>
            </div>
            <table class="t-items p w100">
              <tr class="t-item clearfix">
                <td class="item-hd col-sm-2">处理时间：</td>
                <td class="item-bd col-sm-10 mb0">{{afterData.updateTime}}</td>
              </tr>
              <tr class="t-item clearfix">
                <td class="item-hd col-sm-2">处理备注：</td>
                <td class="item-bd col-sm-10 mb0">{{afterData.opinion}}</td>
              </tr>
              <tr class="t-item clearfix">
                <td class="item-hd col-sm-2">审核结果：</td>
                <td class="item-bd col-sm-10 mb0">{{afterData.returnType=='RETURN'?'同意退货':'同意退款'}}</td>
              </tr>
            </table>
          </div>
        </ng-container>


        <!--退货订单已发货-->
        <div *ngIf="afterData.state=='DELIVERY'">
          <div class="">
            <legend class="m0" style="height: 51px;line-height: 51px;">退货发货信息</legend>
          </div>
          <table class="t-items p w100">
            <tr class="t-item clearfix">
              <td class="item-hd col-sm-2">物流信息：</td>
              <td class="item-bd col-sm-10 mb0"></td>
            </tr>
            <tr class="t-item clearfix">
              <td class="item-hd col-sm-2">退货发货状态：</td>
              <td class="item-bd col-sm-10 mb0"></td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
  <form class="goods-audit panel panel-danger w96 m-auto mb-xl" (keydown.Enter)="false"  *ngIf="type=='deal'">
    <fieldset class="p0 panel-body">
      <legend class="m0 goods-audit-title">{{afterData.state=='DELIVERY'?'退还商品审核':'退款/退货申请处理'}}</legend>
      <table class="w100">
        <tr>
          <td class="item-hd col-sm-2">处理意见：</td>
          <ng-container *ngIf="afterData.returnType=='RETURN'">
            <td class="item-bd col-sm-2" *ngIf="afterData.state=='WAIT'">
              <div class="radio c-radio c-radio-nofont p-sm" *ngFor="let item of goodsAudits">
                <label>
                  <input type="radio" name="isPass" [value]="item.key"  [(ngModel)]="isAgree" />
                  <span class="fa fa-circle"></span>{{item.val}}</label>
              </div>
            </td>
            <td class="item-bd col-sm-2" *ngIf="afterData.state=='DELIVERY'">
              <div class="radio c-radio c-radio-nofont p-sm" *ngFor="let item of goodsAudits">
                <label>
                  <input type="radio" name="isPass" [value]="item.key"  [(ngModel)]="isPass" />
                  <span class="fa fa-circle"></span>{{item.val}}</label>
              </div>
            </td>
          </ng-container>

          <td class="col-sm-8 mb0" [class.item-bd]="afterData.state!='DELIVERY'">
            <textarea class="form-control w66 tag-dib align-middle" name="opinion" required
                      [(ngModel)]="opinion" placeholder="请填写处理意见"
                      cols="10" rows="3"></textarea>
          </td>
        </tr>
      </table>
    </fieldset>
    <fieldset class="pt-xl m0 text-center">
      <button class="btn btn-green" type="button" *ngIf="afterData.returnType=='REFUND'" (click)="auditRefund()"
              [disabled]="!opinion">
        <em class="fa fa-upload mr"></em>提交处理结果
      </button>
      <ng-container *ngIf="afterData.returnType=='RETURN'">
        <button class="btn btn-green" type="button" *ngIf="afterData.state=='WAIT'" (click)="auditReturn()"
                [disabled]="!opinion">
          <em class="fa fa-upload mr"></em>提交处理结果
        </button>
        <button class="btn btn-green" type="button" *ngIf="afterData.state=='DELIVERY'" (click)="auditReturnGoods()"
                [disabled]="!opinion">
          <em class="fa fa-upload mr"></em>提交处理结果
        </button>
      </ng-container>
    </fieldset>
  </form>
</div>
